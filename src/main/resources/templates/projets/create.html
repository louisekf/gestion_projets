<!DOCTYPE html>
<html lang="fr"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<body>

<th:block th:replace="~{fragments/layout :: page(title='Nouveau projet', content=~{::content})}">
  <content>

    <div class="breadcrumb">
      <a th:href="@{/dashboard}">Accueil</a>
      <span class="separator">‚Ä∫</span>
      <a th:href="@{/projets}">Projets</a>
      <span class="separator">‚Ä∫</span>
      <span class="current">Nouveau projet</span>
    </div>

    <div style="max-width: 820px;">

      <div class="flex-between mb-4">
        <div>
          <h2 style="font-family:var(--font-display);font-size:22px;font-weight:700">Cr√©er un projet</h2>
          <p class="text-muted text-sm mt-1">Remplissez les informations du projet de recherche</p>
        </div>
      </div>

      <form th:action="@{/projets}" method="post" th:object="${projetRequest}">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <!-- Section: Informations g√©n√©rales -->
        <div class="card mb-4">
          <div class="card-header">
            <span class="card-title">üìã Informations g√©n√©rales</span>
          </div>
          <div class="card-body">

            <div class="form-group">
              <label class="form-label" for="titre">Titre du projet <span class="required">*</span></label>
              <input type="text" id="titre" th:field="*{titre}"
                     class="form-control" th:classappend="${#fields.hasErrors('titre')} ? 'is-invalid'"
                     placeholder="Ex: D√©veloppement d'un syst√®me de d√©tection pr√©coce..."/>
              <div class="invalid-feedback" th:if="${#fields.hasErrors('titre')}">
                ‚ö† <span th:errors="*{titre}"></span>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label" for="description">Description</label>
              <textarea id="description" th:field="*{description}"
                        class="form-control"
                        placeholder="D√©crivez les objectifs, la m√©thodologie et les r√©sultats attendus..."
                        rows="4"></textarea>
            </div>

            <div class="form-row">
              <div class="form-group mb-0">
                <label class="form-label" for="domaineId">Domaine de recherche <span class="required">*</span></label>
                <select id="domaineId" th:field="*{domaineId}"
                        class="form-control form-select"
                        th:classappend="${#fields.hasErrors('domaineId')} ? 'is-invalid'">
                  <option value="">-- S√©lectionner --</option>
                  <option th:each="d : ${domaines}"
                          th:value="${d.id}"
                          th:text="${d.nom}">Domaine</option>
                </select>
                <div class="invalid-feedback" th:if="${#fields.hasErrors('domaineId')}">
                  ‚ö† <span th:errors="*{domaineId}"></span>
                </div>
              </div>

              <div class="form-group mb-0">
                <label class="form-label" for="institution">Institution</label>
                <input type="text" id="institution" th:field="*{institution}"
                       class="form-control"
                       placeholder="Ex: CNRS, IRD, Universit√©......"/>
              </div>
            </div>

          </div>
        </div>

        <!-- Section: Planification -->
        <div class="card mb-4">
          <div class="card-header">
            <span class="card-title">üìÖ Planification & Statut</span>
          </div>
          <div class="card-body">

            <div class="form-row">
              <div class="form-group mb-0">
                <label class="form-label" for="dateDebut">Date de d√©but</label>
                <input type="date" id="dateDebut" th:field="*{dateDebut}" class="form-control"/>
              </div>
              <div class="form-group mb-0">
                <label class="form-label" for="dateFin">Date de fin pr√©vue</label>
                <input type="date" id="dateFin" th:field="*{dateFin}" class="form-control"/>
              </div>
            </div>

            <div class="form-row mt-4">
              <div class="form-group mb-0">
                <label class="form-label" for="statut">Statut <span class="required">*</span></label>
                <select id="statut" th:field="*{statut}"
                        class="form-control form-select"
                        th:classappend="${#fields.hasErrors('statut')} ? 'is-invalid'">
                  <option value="">-- S√©lectionner --</option>
                  <option value="PLANIFIE">Planifi√©</option>
                  <option value="EN_COURS">En cours</option>
                  <option value="SUSPENDU">Suspendu</option>
                  <option value="TERMINE">Termin√©</option>
                  <option value="ANNULE">Annul√©</option>
                </select>
              </div>

              <div class="form-group mb-0">
                <label class="form-label" for="budgetEstime">Budget estim√© (FCFA)</label>
                <input type="number" id="budgetEstime" th:field="*{budgetEstime}"
                       class="form-control" min="0" step="1000"
                       placeholder="Ex: 5000000"/>
              </div>
            </div>

            <!-- Avancement slider -->
            <div class="form-group mt-4 mb-0">
              <label class="form-label">
                Niveau d'avancement : <strong id="avancementLabel">0%</strong>
              </label>
              <input type="range" id="niveauAvancement" th:field="*{niveauAvancement}"
                     min="0" max="100" step="5"
                     class="w-100"
                     style="accent-color: var(--primary); cursor:pointer; height:6px"/>
              <div class="flex-between text-sm text-muted mt-1">
                <span>0%</span><span>50%</span><span>100%</span>
              </div>
            </div>

          </div>
        </div>

        <!-- Section: Responsable (MANAGER/ADMIN) -->
        <th:block th:if="${isManagerOrAdmin}">
          <div class="card mb-4">
            <div class="card-header">
              <span class="card-title">üë• Affectation</span>
            </div>
            <div class="card-body">
              <div class="form-group mb-0">
                <label class="form-label" for="responsableId">Responsable du projet</label>
                <select id="responsableId" th:field="*{responsableId}"
                        class="form-control form-select">
                  <option value="">-- Moi-m√™me (par d√©faut) --</option>
                  <option th:each="u : ${users}"
                          th:value="${u.id}"
                          th:text="${u.nomComplet + ' (' + u.email + ')'}">Utilisateur</option>
                </select>
                <div class="form-hint">Laissez vide pour vous affecter automatiquement</div>
              </div>
            </div>
          </div>
        </th:block>

        <!-- Buttons -->
        <div class="flex gap-3">
          <button type="submit" class="btn btn-accent btn-lg">
            ‚úÖ Cr√©er le projet
          </button>
          <a th:href="@{/projets}" class="btn btn-outline btn-lg">Annuler</a>
        </div>

      </form>
    </div>

  </content>
</th:block>

</body>
</html>
